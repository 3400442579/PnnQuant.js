!function(){function t(t){this.opts=t,this.qPixels=[]}function r(t){t/=255;return t<.04045?t/12.92:Math.pow((.055+t)/1.055,2.4)}function P(t,e,i,h,s,n){function o(t,e,i){return.2126*r(t)+.7152*r(e)+.0722*r(i)}t=o(t,e,i),e=o(h,s,n);return 100*Math.abs(e-t)}function D(t,e,i,h,s,n){function o(t,e,i){return-.09991*t-.33609*e+.436*i}t=o(t,e,i),e=o(h,s,n);return Math.abs(e-t)}function E(t){var e=255&t,i=t>>>8&255,h=t>>>16&255,t=t>>>24&255;this.yDiff=0,this.p=[e,i,h,t]}Math.tanh||(Math.tanh=function(t){var e=Math.exp(+t),t=Math.exp(-t);return e==1/0?1:t==1/0?-1:(e-t)/(e+t)});var L,U,q,n,A,I,_,C,o,O,S,T,k,F,G,R,j=[],z=[],H=9,p=343;function J(t,e,i,h){var s,n,o=t+e*q,r=A[o],p=255&i,a=i>>>8&255,f=i>>>16&255,l=i>>>24&255,g=Math.max(2,C-G),u=(C<=4&&.2<_[o]&&_[o]<.25?i=new BlueNoise({weightB:2*h/_[o]}).diffuse(r,I[O[o]],1/3,t,e):(C<=4||P(r0,g0,b0,p,a,f)<2*g)&&(u=255&(i=new BlueNoise({weightB:.5*h/_[o]}).diffuse(r,I[O[o]],1/3,t,e)),w=i>>>8&255,d=i>>>16&255,C<=4&&D(r0,g0,b0,u,w,d)>8*g&&(n=.65<_[o]?r:l<<24|f<<16|a<<8|p,u=255&(i=new BlueNoise({weightB:h*_[o]}).diffuse(n,I[O[o]],1/3,t,e)),w=i>>>8&255,d=i>>>16&255),u=255&(i=D(r0,g0,b0,u,w,d)>G*g?new BlueNoise({weightB:h/_[o]}).diffuse(r,I[O[o]],1/3,t,e):i),w=i>>>8&255,d=i>>>16&255),255&i),w=i>>>8&255,d=i>>>16&255,r=(C<3||6<G?4<C&&(P(r0,g0,b0,u,w,d)>h*g||D(r0,g0,b0,u,w,d)>2*g)&&(s=_[o]<.4?.4*h*_[o]:.4*h/_[o],n=_[o]<.6?r:l<<24|f<<16|a<<8|p,u=255&(i=new BlueNoise({weightB:s}).diffuse(n,I[O[o]],1/3,t,e)),w=i>>>8&255,d=i>>>16&255):4<C&&(P(r0,g0,b0,u,w,d)>h*g||D(r0,g0,b0,u,w,d)>g)&&(u=255&(i=h<.3&&(C<=32||_[o]<h)?new BlueNoise({weightB:.4*h*_[o]}).diffuse(i,I[O[o]],1/3,t,e):l<<24|f<<16|a<<8|p),w=i>>>8&255,d=i>>>16&255),H<16&&_[o]<.6&&P(r0,g0,b0,u,w,d)>G-1&&(i=l<<24|f<<16|a<<8|p,u=p,w=a,d=f),U(l,u,w,d));return 0==S[r]&&(S[r]=L(I,i,o)+1),S[r]-1}function J(t,e){for(var i=t+e*q,h=A[i],s=new E(h),n=F?z.length-1:0,o=H-1,r=0;r<j.length;++r){var p=j[r];if(n<0||n>=z.length)break;for(var a=0;a<p.p.length;++a)s.p[a]+=p.p[a]*z[n],s.p[a]>o&&(o=s.p[a]);n+=F?-1:1}for(var f=0|Math.clamp(s.p[0],0,255),l=0|Math.clamp(s.p[1],0,255),g=0|Math.clamp(s.p[2],0,255),u=0|Math.clamp(s.p[3],0,255),w=255&h,d=h>>>8&255,M=h>>>16&255,c=u<<24|g<<16|l<<8|f,x=(null!=_&&k&&!F?O[i]=J(t,e):C<=32&&240<u?(x=U(u,f,l,g),0==S[x]&&(S[x]=L(I,c,i)+1),O[i]=S[x]-1,x=Math.max(2,C-G),null!=_&&(P(w,d,M,f,l,g)>x||D(w,d,M,f,l,g)>2*x)&&(c=new BlueNoise({weightB:1/_[i]}).diffuse(h,I[O[i]],1/3,t,e),O[i]=L(I,c,i))):O[i]=L(I,c,i),j.length>=H?j.shift():0<j.length&&K(j.length),255&(c=I[O[i]])),h=c>>>8&255,b=c>>>16&255,v=c>>>24&255,f=(s.p[0]=f-x,s.p[1]=l-h,s.p[2]=g-b,s.p[3]=u-v,2<I.length),y=TELL_BLUE_NOISE[4095&i]>R,B=(s.yDiff=F?P(w,d,M,x,h,b):1,!y&&TELL_BLUE_NOISE[4095&(4096*s.yDiff|0)]>R),m=!1,N=f?s.p.length-1:0,a=0;a<N;++a)Math.abs(s.p[a])>=T&&(F&&null!=_&&(m=!0),y?s.p[a]=Math.fround(Math.tanh(s.p[a]/o*20))*(T-1):B?s.p[a]=Math.fround(s.p[a]/o*s.yDiff)*(T-1):s.p[a]/=Math.fround(1+Math.sqrt(T)));m&&(O[i]=J(t,e),c=I[O[i]]),j.push(s),F&&j.sort(function(t,e){return e.yDiff<t.yDiff?-1:t.yDiff<e.yDiff?1:0})}function b(t,e,i,h,s,n){var o=Math.abs(i+h),r=Math.abs(s+n),p=Math.sign(i),a=Math.sign(h),f=Math.sign(s),l=Math.sign(n);if(1==r)for(var g=0;g<o;++g)J(t,e),t+=p,e+=a;else if(1==o)for(g=0;g<r;++g)J(t,e),t+=f,e+=l;else{var u=i>>1,w=h>>1,d=s>>1,M=n>>1,c=Math.abs(u+w),x=Math.abs(d+M);3*r<2*o?(c%2!=0&&2<o&&(u+=p,w+=a),b(t,e,u,w,s,n),b(t+u,e+w,i-u,h-w,s,n)):(x%2!=0&&2<r&&(d+=f,M+=l),b(t,e,d,M,u,w),b(t+d,e+M,i,h,s-d,n-M),b(t+(i-p)+(d-f),e+(h-a)+(M-l),-d,-M,-(i-u),-(h-w)))}}function K(t){var e=Math.fround(Math.pow(p+1,1/(t-1))),i=1,h=0;z=new Array(t);for(var s=0;s<t;++s)j.push(new E(0)),h+=z[t-s-1]=i,i/=e;for(i=0,s=0;s<t;++s)z[s]=Math.fround(z[s]/h),i+=z[s];z[0]+=Math.fround(1-i)}t.prototype.dither=function(){j=[];var t=this.opts.weight<0,e=(this.opts.weight=Math.abs(this.opts.weight),G=this.opts.weight<.0025?12:this.opts.weight<.004?8:6,F=128<=this.opts.palette.length&&(!t||this.opts.weight<.18),H=this.opts.weight<.015?.0025<this.opts.weight?25:16:9,t?1:Math.exp(this.opts.weight)-.25),i=!t&&.002<this.opts.weight?-.25:1,i=(T=t||9<H?Math.pow(Math.sqrt(H)+e*i,2):2*H,16<this.opts.palette.length?3200:1500);if((5e3<this.opts.palette.length/this.opts.weight&&(.045<this.opts.weight||.01<this.opts.weight&&this.opts.palette.length<64)||this.opts.weight<.03&&this.opts.palette.length/this.opts.weight<i&&16<=this.opts.palette.length&&this.opts.palette.length<128)&&(T=Math.pow(5+e,2)),T|=0,R=9<H?-112:-64,z=[],S=new Uint32Array(65536),L=this.opts.ditherFn,U=this.opts.getColorIndex,q=this.opts.width,n=this.opts.height,A=this.opts.pixels,I=this.opts.palette,_=t?null:this.opts.saliencies,k=this.opts.dithering,C=I.length,o=4<C?.6-.00625*C:1,4<C?(i=.005-625e-7*C,o=Math.fround(this.opts.weight>i?.25:Math.min(1.5,o+C*this.opts.weight)),32<C&&C<256&&(o+=.1)):o*=.95,(64<C||4<C&&.02<this.opts.weight)&&(o*=.4),O=new(256<C?Uint16Array:Uint8Array)(A.length),F||K(H),n<=q?b(0,0,q,0,0,n):b(0,0,0,n,q,0),this.opts.indexedPixels=this.qPixels=O,this.opts.dithering){for(var h=new Uint32Array(O.length),s=0;s<O.length;++s)h[s]=I[O[s]];return h}return O},t.prototype.getIndexedPixels=function(){return this.qPixels},t.prototype.getResult=function(){var i=this;return new Promise(function(t,e){i.opts.dithering||i.opts.colors<=32?t({img8:i.dither(),indexedPixels:i.getIndexedPixels()}):t({indexedPixels:i.dither()})})},this.GilbertCurve=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}.call(this);
