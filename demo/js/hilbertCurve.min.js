(function(){function t(t){this.opts=t||{},this.qPixels=[]}Math.clamp||(Math.clamp=function(t,e,i){return this.max(e,this.min(i,t))});var e,i,r,s,a,n,h,p,o,c,l=4,f=6,u=2,d=8;function m(t){var e=255&t,i=t>>>8&255,r=t>>>16&255,s=t>>>24&255;this.p=[e,i,r,s]}var v,w=[],x=[],g=16,M=256;function b(){if(e>=0&&i>=0&&e<a&&i<n){for(var t=h[e+i*a],l=new m(t),f=0;f<g;++f)for(var u=w[f],d=0;d<u.p.length;++d)l.p[d]+=u.p[d]*x[f];var b=Math.clamp(l.p[0],0,M-1),y=Math.clamp(l.p[1],0,M-1),k=Math.clamp(l.p[2],0,M-1),A=Math.clamp(l.p[3],0,M-1),P=A<<24|k<<16|y<<8|b,U=s(A,b,y,k);0==v[U]&&(v[U]=t>>>24&!1?1:r(p,o,P)+1),c[e+i*a]=v[U]-1,w.shift();var q=255&(P=p[c[e+i*a]]),C=P>>>8&255,I=P>>>16&255,F=P>>>24&255;l.p[0]=b-q,l.p[1]=y-C,l.p[2]=k-I,l.p[3]=A-F;for(d=0;d<l.p.length;++d)Math.abs(l.p[d])>g&&(l.p[d]=l.p[d]<0?-g:g);w.push(l)}}function y(t){switch(b(),t){case l:--e;break;case f:++e;break;case d:--i;break;case u:++i}}function k(t,e,i,r,s,a,n,h){A(t-1,e),y(a),A(t-1,i),y(n),A(t-1,r),y(h),A(t-1,s)}function A(t,e){if(!(t<=0))switch(e){case l:k(t,d,l,l,u,f,u,l);break;case f:k(t,u,f,f,d,l,d,f);break;case d:k(t,l,d,d,f,u,f,d);break;case u:k(t,f,u,u,l,d,l,u)}}t.prototype.dither=function(){e=i=0,w=[],x=[],v=new Uint32Array(65536);for(var t=Math.pow(M+1,1/(g-1)),y=1,A=0,P=0;P<g;++P)w.push(new m(0)),A+=x[g-P-1]=1/y,y*=t;y=0;for(P=0;P<g;++P)y+=x[P]/=A;x[0]+=1-y;for(var U=Math.max(this.opts.width,this.opts.height),q=0;U>0;)++q,U>>=1;r=this.opts.ditherFn,s=this.opts.getColorIndex,a=this.opts.width,n=this.opts.height,h=this.opts.pixels,p=this.opts.palette,o=this.opts.colors,c=o>256?new Uint16Array(h.length):new Uint8Array(h.length),k(q,l,d,d,f,u,f,d),b();var C=function(){for(var t=new Uint32Array(c.length),e=0;e<c.length;++e)t[e]=p[c[e]];return t}();return this.qPixels=c,C},t.prototype.getIndexedPixels=function(){return this.qPixels},this.HilbertCurve=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(this);