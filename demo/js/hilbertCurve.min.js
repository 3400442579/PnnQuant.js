(function(){function t(t){this.opts=t||{},this.qPixels=[]}Math.clamp||(Math.clamp=function(t,e,i){return this.max(e,this.min(i,t))});var e,i,n,r,s,a,h,o,p,c,l=4,f=6,u=2,d=8;function x(t){var e=255&t,i=t>>>8&255,n=t>>>16&255,r=t>>>24&255;this.p=[e,i,n,r]}var m,g=[],v=[],w=16;function M(){if(e>=0&&i>=0&&e<s&&i<a){for(var t=h[e+i*s],l=new x(t),f=0;f<w;++f)for(var u=g[f],d=0;d<u.p.length;++d)l.p[d]+=u.p[d]*v[f];var M=Math.clamp(l.p[0],0,255),b=Math.clamp(l.p[1],0,255),y=Math.clamp(l.p[2],0,255),P=Math.clamp(l.p[3],0,255),k=P<<24|y<<16|b<<8|M;if(p<64){var A=r(P,M,b,y);0==m[A]&&(m[A]=t>>>24&!1?1:n(o,p,k)+1),c[e+i*s]=m[A]-1}else c[e+i*s]=n(o,p,k);g.shift();var U=255&(k=o[c[e+i*s]]),q=k>>>8&255,I=k>>>16&255,C=k>>>24&255;l.p[0]=M-U,l.p[1]=b-q,l.p[2]=y-I,l.p[3]=P-C;for(d=0;d<l.p.length;++d)Math.abs(l.p[d])<w||(p<64?l.p[d]=l.p[d]<0?1-w:w-1:l.p[d]-=l.p[d]<0?-w:w);g.push(l)}}function b(t){switch(M(),t){case l:--e;break;case f:++e;break;case d:--i;break;case u:++i}}function y(t,e,i,n,r,s,a,h){P(t-1,e),b(s),P(t-1,i),b(a),P(t-1,n),b(h),P(t-1,r)}function P(t,e){if(!(t<=0))switch(e){case l:y(t,d,l,l,u,f,u,l);break;case f:y(t,u,f,f,d,l,d,f);break;case d:y(t,l,d,d,f,u,f,d);break;case u:y(t,f,u,u,l,d,l,u)}}t.prototype.dither=function(){e=i=0,g=[],v=[],m=new Uint32Array(65536);for(var t=Math.pow(257,1/(w-1)),l=1,f=0,u=0;u<w;++u)g.push(new x(0)),f+=v[w-u-1]=1/l,l*=t;l=0;for(u=0;u<w;++u)l+=v[u]/=f;v[0]+=1-l;for(var b=Math.max(this.opts.width,this.opts.height),y=0;b>0;)++y,b>>=1;return n=this.opts.ditherFn,r=this.opts.getColorIndex,s=this.opts.width,a=this.opts.height,h=this.opts.pixels,o=this.opts.palette,p=this.opts.colors,c=p>256?new Uint16Array(h.length):new Uint8Array(h.length),P(y,d),M(),this.qPixels=c,function(){for(var t=new Uint32Array(c.length),e=0;e<c.length;++e)t[e]=o[c[e]];return t}()},t.prototype.getIndexedPixels=function(){return this.qPixels},t.prototype.getResult=function(){var t=this;return new Promise(function(e,i){e({img8:t.dither(),indexedPixels:t.getIndexedPixels()})})},this.HilbertCurve=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(this);