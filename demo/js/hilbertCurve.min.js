(function(){function t(t){this.opts=t||{},this.qPixels=[]}Math.clamp||(Math.clamp=function(t,e,i){return this.max(e,this.min(i,t))});var e,i,s,a,r,n,h,p,o,l,c=4,f=6,u=2,d=8;function m(t){var e=255&t,i=t>>>8&255,s=t>>>16&255,a=t>>>24&255;this.p=[e,i,s,a]}var v,x=[],w=[],g=16;function M(){if(e>=0&&i>=0&&e<r&&i<n){for(var t=h[e+i*r],c=new m(t),f=0;f<g;++f)for(var u=x[f],d=0;d<u.p.length;++d)c.p[d]+=u.p[d]*w[f];var M=Math.clamp(c.p[0],0,255),b=Math.clamp(c.p[1],0,255),y=Math.clamp(c.p[2],0,255),k=Math.clamp(c.p[3],0,255),P=k<<24|y<<16|b<<8|M;if(o<64){var q=a(k,M,b,y);0==v[q]&&(v[q]=t>>>24&!1?1:s(p,o,P)+1),l[e+i*r]=v[q]-1}else l[e+i*r]=s(p,o,P);x.shift();var A=255&(P=p[l[e+i*r]]),U=P>>>8&255,C=P>>>16&255,I=P>>>24&255;c.p[0]=M-A,c.p[1]=b-U,c.p[2]=y-C,c.p[3]=k-I;for(d=0;d<c.p.length;++d)Math.abs(c.p[d])<g||(o<64?c.p[d]=c.p[d]<0?1-g:g-1:c.p[d]-=c.p[d]<0?-g:g);x.push(c)}}function b(t){switch(M(),t){case c:--e;break;case f:++e;break;case d:--i;break;case u:++i}}function y(t,e,i,s,a,r,n,h){k(t-1,e),b(r),k(t-1,i),b(n),k(t-1,s),b(h),k(t-1,a)}function k(t,e){if(!(t<=0))switch(e){case c:y(t,d,c,c,u,f,u,c);break;case f:y(t,u,f,f,d,c,d,f);break;case d:y(t,c,d,d,f,u,f,d);break;case u:y(t,f,u,u,c,d,c,u)}}t.prototype.dither=function(){e=i=0,x=[],w=[],v=new Uint32Array(65536);for(var t=Math.pow(257,1/(g-1)),c=1,f=0,u=0;u<g;++u)x.push(new m(0)),f+=w[g-u-1]=1/c,c*=t;c=0;for(u=0;u<g;++u)c+=w[u]/=f;w[0]+=1-c;for(var b=Math.max(this.opts.width,this.opts.height),y=0;b>0;)++y,b>>=1;return s=this.opts.ditherFn,a=this.opts.getColorIndex,r=this.opts.width,n=this.opts.height,h=this.opts.pixels,p=this.opts.palette,o=this.opts.colors,l=o>256?new Uint16Array(h.length):new Uint8Array(h.length),k(y,d),M(),this.qPixels=l,this.opts.paletteOnly?this.qPixels:function(){for(var t=new Uint32Array(l.length),e=0;e<l.length;++e)t[e]=p[l[e]];return t}()},t.prototype.getIndexedPixels=function(){return this.qPixels},this.HilbertCurve=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(this);