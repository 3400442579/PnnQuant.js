(function(){function t(t){this.opts=t||{},this.qPixels=[]}Math.clamp||(Math.clamp=function(t,e,i){return this.max(e,this.min(i,t))});var e,i,s,n,r,p,a,o,h,l,c=4,f=6,u=2,d=8;function x(t){var e=255&t,i=t>>>8&255,s=t>>>16&255,n=t>>>24&255;this.p=[e,i,s,n]}var m,g=[],v=[],w=16;function y(){if(e>=0&&i>=0&&e<r&&i<p){for(var t=a[e+i*r],c=new x(t),f=0;f<w;++f)for(var u=g[f],d=0;d<u.p.length;++d)c.p[d]+=u.p[d]*v[f];var y=Math.clamp(c.p[0],0,255),M=Math.clamp(c.p[1],0,255),b=Math.clamp(c.p[2],0,255),P=Math.clamp(c.p[3],0,255),k=P<<24|b<<16|M<<8|y;if(h<64){var A=n(P,y,M,b);0==m[A]&&(m[A]=t>>>24&!1?1:s(o,h,k)+1),l[e+i*r]=m[A]-1}else l[e+i*r]=s(o,h,k);g.shift();var U=255&(k=o[l[e+i*r]]),q=k>>>8&255,I=k>>>16&255,C=k>>>24&255;c.p[0]=y-U,c.p[1]=M-q,c.p[2]=b-I,c.p[3]=P-C;for(d=0;d<c.p.length;++d)Math.abs(c.p[d])<w||(h<64?c.p[d]=c.p[d]<0?1-w:w-1:c.p[d]-=c.p[d]<0?-w:w);g.push(c)}}function M(t){switch(y(),t){case c:--e;break;case f:++e;break;case d:--i;break;case u:++i}}function b(t,e,i,s,n,r,p,a){P(t-1,e),M(r),P(t-1,i),M(p),P(t-1,s),M(a),P(t-1,n)}function P(t,e){if(!(t<=0))switch(e){case c:b(t,d,c,c,u,f,u,c);break;case f:b(t,u,f,f,d,c,d,f);break;case d:b(t,c,d,d,f,u,f,d);break;case u:b(t,f,u,u,c,d,c,u)}}t.prototype.dither=function(){e=i=0,g=[],v=[],m=new Uint32Array(65536);for(var t=Math.pow(257,1/(w-1)),c=1,f=0,u=0;u<w;++u)g.push(new x(0)),f+=v[w-u-1]=1/c,c*=t;c=0;for(u=0;u<w;++u)c+=v[u]/=f;v[0]+=1-c;for(var M=Math.max(this.opts.width,this.opts.height),b=0;M>0;)++b,M>>=1;return s=this.opts.ditherFn,n=this.opts.getColorIndex,r=this.opts.width,p=this.opts.height,a=this.opts.pixels,o=this.opts.palette,h=this.opts.colors,l=h>256?new Uint16Array(a.length):new Uint8Array(a.length),P(b,d),y(),this.qPixels=l,function(){for(var t=new Uint32Array(l.length),e=0;e<l.length;++e)t[e]=o[l[e]];return t}()},t.prototype.getIndexedPixels=function(){return this.qPixels},t.prototype.getResult=function(){var t=this;return new Promise(function(e,i){e({img8:t.dither(),pal8:t.opts.palette,indexedPixels:t.getIndexedPixels(),transparent:t.opts.transparent,type:t.opts.type})})},this.HilbertCurve=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(this);